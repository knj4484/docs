---
title: メトリック名とラベル名
sort_rank: 1
---

# メトリック名とラベル名

このドキュメントで提示されているメトリックとラベルの規約は、Prometheusの利用にあたって必須とは言えないが、スタイルガイドおよびベストプラクティスとして利用できる。個々の組織では、これらのプラクティスのいくつか（例えば、命名規約）を変更したいかもしれない。

## メトリック名

メトリック名は、

* 正当な文字に関して[データモデル](/ja/docs/concepts/data_model/#metric-names-and-labels)に従わなければならない
* そのメトリックが属しているドメインに関する一単語のアプリケーションprefixを付けるべきである。このprefixは、クライアントライブラリでは、名前空間（namespace）と呼ばれることがある。あるアプリケーションの特有のメトリックでは、アプリケーション名自体が普通はprefixとなる。クライアントライブラリからexportされている標準化されたメトリックのように一般的なものもある。例えば、
  * <code><b>prometheus</b>\_notifications\_total</code>
    (Prometheusサーバーに特有のもの)
  * <code><b>process</b>\_cpu\_seconds\_total</code>
    (たくさんのクライアントライブラリからexportされたもの)
  * <code><b>http</b>\_request\_duration\_seconds</code>
    (全てのHTTPリクエストのためのもの)
* 単位を一つだけ持つべきである。秒とミリ秒を混ぜたり、秒とバイトを混ぜたりしないこと。
* 基本単位を使うべきである。例えば、ミリ秒、メガバイト、キロメーターではなく、秒、バイト、メーターを使う。
* 単位を複数形で表したsuffixを付けるべきである。カウントには、suffixとして、(適用可能な単位があればそれに加えて）`total`を付けること。
  * <code>http\_request\_duration\_<b>seconds</b></code>
  * <code>node\_memory\_usage\_<b>bytes</b></code>
  * <code>http\_requests\_<b>total</b></code>
    (単位がないカウント)
  * <code>process\_cpu\_<b>seconds\_total</b></code>
    (単位のあるカウント)
* 全てのラベル軸を通して同一の論理的な測定対象を表すべきである。
  * リクエスト持続時間
  * 転送データのバイト数
  * 瞬間的なリソース利用のパーセント

大まかなルールとして、`sum()`や`avg()`が全ての軸に対して意味をなすようにするべきである。
もしそれらが意味をなさないなら、そのデータを複数のメトリクスに分解すること。
例えば、様々なキューの容量を一つのメトリックとして持つことは良いが、キューの現在の要素数を混ぜるのは良くない。

## ラベル

ラベルは、測定されるものの特徴が区別できるように使うこと。

- `api_http_requests_total` - リクエストタイプが区別できるようにする: `type="create|update|delete"`
- `api_request_duration_seconds` - リクエストの段階が区別できるようにする: `stage="extract|transform|load"`

ラベル名をメトリック名に入れないこと。入れてしまうと、集約してそのラベルがなくなったときに混乱を起こす。

CAUTION: 全てのkey-valueの組み合わせは新しい時系列となり、データ量を劇的に増やしてしまう。沢山の値を持つラベル（ユーザーIDやメールアドレス、その他の無限集合であるもの）は使わないこと

## 基本単位

Prometheusには、ハードコードされた単位はない。
互換性をよくするために、基本単位を用いるべきである。
以下に、いくつかのメトリクスの種類とその基本単位の一覧を示す。
この一覧は網羅的ではない。

| 種類 | 基本単位 | 備考 | 
| -------| --------- | ------ |
| 時間   | seconds   |        |
| 気温 | celsius | セルシウスが実際に遭遇する最もよくある単位である |
| 長さ | meters | |
| バイト  | bytes | | 
| ビット   | bytes | |
| パーセント | ratio(*) | 値は0-1である。<br/>普通、ratioをサフィックスとして使うのではなく、A\_per\_Bとする。例外は、例えば、disk\_usage\_ratioである |
| 電圧 | volts | |
| 電流 | amperes | | 
| エネルギー | joules | |
| 重さ | grams | |
 
